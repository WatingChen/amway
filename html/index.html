<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>云购首页</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/nav.css">
</head>
<body>
    <div id="header"></div>
    <header></header>

    <nav></nav>

    <section id="banner"></section>

    <section id="guess_u_like"></section>

    <!-- <section id="brand1">
        <div class="margin">
            <div class="cat-name">
                <h2 class="every_brand">
                    纽崔莱
                    <span>
                        更多
                        <i></i>
                    </span>
                </h2>
            </div>
            <div class="brand_content">
                <div class="brand_img"><img src="https://staticd.amway.com.cn/medias/sys_master/images/images/h47/hea/8998011928606/PC-266-520.jpg" alt=""></div>
                <div class="brand_some">
                    <div class="brand_classes">
                        <ul>
                            <li>基础营养系列</li>
                            <li>功能保健系列</li>
                            <li>体重管理系列</li>
                            <li>儿童成长系列</li>
                        </ul>
                    </div>
                    <div class="brand_some_products">
                        <ul>
                            <li>基础营养系列</li>
                            <li>功能保健系列</li>
                            <li>体重管理系列</li>
                            <li>儿童成长系列</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section> -->

    <section id="row"></section>

    <div id="footer"></div>
</body>
<script src="../libs/jquery.js"></script>
<script src="../libs/jQuery.banner.1.0.js"></script>
<script src="../libs/ajax.js"></script>
<script src="../js/index.js"></script>
<script>
    class Home{
        constructor(){
            this.userAllMsg = localStorage.getItem("userMsg") ? JSON.parse(localStorage.getItem("userMsg")) : [{pass:"",onoff:0}];
            this.guess_u_like = document.querySelector("#guess_u_like");
            
            this.init();
        }
        addEvent(){
            this.userName = document.querySelector("#userName");
            var that = this;
            $("#guess_u_like").on("click","#a_goodsid",function(){
                localStorage.setItem("a_goodsid",$(this).attr("goodsid"));
                open("goodsdetails.html","_blank");
            })
        }

        init(){
            var that = this;
            $("header").load("http://localhost:82/html/header.html",function(){
                // 选择送货地点
                var localOnOff = 0;
                $(".header_local").on("click",function(){
                    if(localOnOff == 0){
                        $(".header_local").find(".local").addClass("active");
                        $(".delivery-to").css({
                            display:"block"
                        })
                        localOnOff = 1;
                    }else{
                        $(".header_local").find(".local").removeClass("active");
                        $(".delivery-to").css({
                            display:"none"
                        })
                        localOnOff = 0;
                    }
                })
                let arr = ["北京市","上海市","天津市","重庆市","安徽省","安徽省安庆市","福建省","甘肃省","广东省","广西自治区","贵州省","海南省","河北省","河南省","黑龙江省","湖北省","湖南省","吉林省","江苏省","江西省","辽宁省","宁夏自治区","青海省","山东省","山西省","陕西省","四川省","西藏自治区","新疆自治区","云南省","浙江省","内蒙古自治区（西部）","内蒙古自治区（中部）","内蒙古自治区（北部）"];
                let str = "";
                let length = arr.length;
                // console.log(length);
                for(var i=0;i<length;i++){
                    str += `<li style="height: auto;">
                                <div class="areas-v">
                                    <span>${arr[i]}</span>
                                </div>
                            </li>`;
                }
                $(".delivery-to").children(".area-shi-ul").html(str);
// ===========================================================

                // 滚动事件搜索框变动
                onscroll = function(){
                    if($(document).scrollTop() > 70){
                        $("header").find(".header_local").css({display:"none"}).end().find(".login").css({display:"none"}).end().find(".delivery-to").css({display:"none"}).end().find(".local").removeClass("active");
                        localOnOff = 0;
                        // console.log($("header").find(".nav_search").length)
                        if(!$("header").find(".nav_search").length){
                            $("header").children(".margin").append(`<div class="nav_search">
                                <form>
                                    <div class="nav_search_toggle"><span>产品</span><img src="../img/arrow_down.png" alt="" class="toggle_arrow"></div>
                                    <input type="text" id="txt">
                                    <img src="../img/search.png" alt="" class="search">
                                </form>
                            </div>`);

                        }else{
                            $("header").find(".nav_search").css({
                                display:"block"
                            })
                        }
                    }else if($(document).scrollTop() < 70){
                        $("header").find(".header_local").css({display:"block"}).end().find(".login").css({display:"block"}).end().find(".nav_search").css({
                            display:"none"
                        })
                    }
                }
// ===========================================================

                // 用户是否登录
                var i = 0;
                var loginOnOff = that.userAllMsg.some((value,index)=>{
                    i = index;
                    return value.onoff != 0;
                })
                if(loginOnOff){
                    $("header").find(".welcome").css({display:"none"}).end().find(".welcome_1").css({display:"block"}).find("span").html(that.userAllMsg[i].user);
                }else{
                    $("header").find(".welcome").css({display:"block"}).end().find(".welcome_1").css({display:"none"});
                }
                $("header").find(".exit").click(function(){
                    that.userAllMsg[i].onoff = 0;
                    localStorage.setItem("userMsg",JSON.stringify(that.userAllMsg));
                    location.reload();
                })
                

            });
// ===========================================================


            $("nav").load("http://localhost:82/html/nav.html",function(){
                
            });



            $("#guess_u_like").load("http://localhost:82/html/guess_u_like.html",function(){
                $.ajax({
                    url:"http://localhost:82/json/guess_u_like.json",
                    success:function(res){
                        let myres = JSON.parse(res);
                        let str = "";
                        let length = myres.length;
                        for(var i=0;i<length;i++){
                            str += `<a goodsId="${myres[i].goodsid}" id="a_goodsid">
                                        <div class="guess_goods_box" >
                                            <div class="guess_goods">
                                                <img src="${myres[i].img}" alt="" class="guess_goods_img">
                                            </div>
                                            <div class="guess_goods_msg"  goodsId="${myres[i].goodsid}">
                                                <p>${myres[i].name}</p>
                                                <span>￥${myres[i].price}.00</span>
                                            </div>
                                        </div>
                                    </a>`;
                        }
                        $("#guess_u_like").children(".margin").append(str);
                        that.addEvent();
                    }
                })
            });



            $("#footer").load("http://localhost:82/html/footer.html");
        }
    }

    new Home();
   


</script>
</html>